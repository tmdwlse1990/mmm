//====================================
// เสา 1 ถึง 4 (แสดงตัวเลขจากการสุ่ม)
//====================================

icecastle,89,272,4	script	Pillar #1	10371,{
	mes "[เสาเรืองแสงที่ 1]";
	mes "คุณเห็นตัวเลขปรากฏขึ้น:";
	mes "^FF0000" + $pillar_code[0] + "^000000";
	close;
}

icecastle,92,272,4	script	Pillar #2	10371,{
	mes "[เสาเรืองแสงที่ 2]";
	mes "คุณเห็นตัวเลขปรากฏขึ้น:";
	mes "^FF0000" + $pillar_code[1] + "^000000";
	close;
}

icecastle,95,272,4	script	Pillar #3	10371,{
	mes "[เสาเรืองแสงที่ 3]";
	mes "คุณเห็นตัวเลขปรากฏขึ้น:";
	mes "^FF0000" + $pillar_code[2] + "^000000";
	close;
}

icecastle,98,272,4	script	Pillar #4	10371,{
	mes "[เสาเรืองแสงที่ 4]";
	mes "คุณเห็นตัวเลขปรากฏขึ้น:";
	mes "^FF0000" + $pillar_code[3] + "^000000";
	close;
}

//====================================
// เสาที่ 5 (ให้ป้อนรหัส ตรวจตำแหน่ง และเฉลย)
//====================================

icecastle,88,265,4	script	Pillar Code	10371,{
	mes "[เสาประตู]";
	mes "ป้อนรหัส 4 หลัก:";
	input .@input$;

	if (getstrlen(.@input$) != 4) {
		mes "ต้องเป็น 4 หลักเท่านั้น!";
		close;
	}

	set .@wrong, 0;

	for (set .@i, 0; .@i < 4; set .@i, .@i + 1) {
		set .@digit$[.@i], charat(.@input$, .@i);
		if (.@digit$[.@i] != "" + $pillar_code[.@i]) {
			mes "หลักที่ " + (.@i+1) + ": ^FF0000ผิด^000000 (คุณใส่ " + .@digit$[.@i] + ", ต้องเป็น " + $pillar_code[.@i] + ")";
			set .@wrong, .@wrong + 1;
		} else {
			mes "หลักที่ " + (.@i+1) + ": ^00FF00ถูกต้อง^000000 (" + .@digit$[.@i] + ")";
		}
	}
	mes "รวมผิดทั้งหมด: " + .@wrong + " หลัก";
	close;
}

//====================================
// สคริปต์สุ่มรหัสตอนโหลดเซิร์ฟเวอร์ (หรือรีโหลด)
//====================================

-	script	PillarInit	-1,{
	OnInit:
		setarray $pillar_code[0], rand(0,10), rand(0,10), rand(0,10), rand(0,10);
		end;
}

//==== โทษตามจำนวนที่ผิด (ปิดไว้ก่อน) ====
	/*
	switch (.@wrong) {
		case 1:
			mes "คุณใส่ผิด 1 ตัว! HP ลดลง 20%!"; percentheal -20, 0; break;
		case 2:
			mes "คุณใส่ผิด 2 ตัว! HP ลดลง 50%!"; percentheal -50, 0; break;
		case 3:
			mes "คุณใส่ผิด 3 ตัว! บาดเจ็บสาหัส!";
			statuschange SC_STUN,10000,0;
			percentheal -99, 0;
			break;
		case 4:
			mes "คุณใส่ผิดทั้ง 4 ตัว! คุณถูกสายฟ้าฟาด!";
			sleep2 1000;
			atcommand "@alive";
			atcommand "@kill";
			break;
	}
	*/