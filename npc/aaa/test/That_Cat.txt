icecastle,184,221,5	script	This Is A Cat	10537,{

	// ===============================
	// GM เริ่มกิจกรรม
	// ===============================
	if (getgmlevel() >= 99) {
		if ($@status_event_active) {
			mes "[Event Staff]";
			mes "กิจกรรมกำลังดำเนินอยู่แล้ว.";
			close;
		}
		mes "[Event Staff]";
		mes "คุณต้องการเริ่มกิจกรรมหรือไม่?";
		if (select("เริ่มกิจกรรม:ยกเลิก") == 2) close;

		$@status_event_active = 1;
		$@status_event_winner$ = "";
		announce "[กิจกรรมสุ่มสถานะ] กิจกรรมจะเริ่มใน 1 นาที! ทุกคนมาที่ icecastle 184,221 ข้างผู้ใหญ่บ้าน!!!", bc_all;
		announce "[กิจกรรมสุ่มสถานะ] รางวัลใหญ่คือ หญ้ายีในตำนาน ที่ใครๆ ก็อยากได้! มาเลย!", bc_all;

		// เริ่มนับถอยหลัง 1 นาที
		for (.@i = 60; .@i > 0; .@i--) {
			if (.@i == 60) {
				announce "[กิจกรรมสุ่มสถานะ] กิจกรรมจะเริ่มใน 1 นาที!", bc_all;
			} else if (.@i == 30) {
				announce "[กิจกรรมสุ่มสถานะ] กิจกรรมจะเริ่มใน 30 วินาที!", bc_all;
			} else if (.@i <= 10 && .@i > 0) {
				announce "[กิจกรรมสุ่มสถานะ] กิจกรรมจะเริ่มใน " + .@i + " วินาที!", bc_all;
			} else if (.@i == 0) {
				announce "[กิจกรรมสุ่มสถานะ] กิจกรรมเริ่มแล้ว! กด NPC เพื่อเข้าร่วมและลุ้นรางวัล!", bc_all;
			}
			sleep2 1000; // นอน 1 วินาที
		}

		initnpctimer;
		close;
	}

	// ===============================
	// GM หยุดกิจกรรม
	// ===============================
	if (getgmlevel() >= 99 && $@status_event_active) {
		mes "[Event Staff]";
		mes "คุณต้องการหยุดกิจกรรมหรือไม่?";
		if (select("หยุดกิจกรรม:ยกเลิก") == 1) {
			$@status_event_active = 0;
			announce "[กิจกรรมสุ่มสถานะ] กิจกรรมถูกหยุดโดย GM.", bc_all;
			stopnpctimer;
			close;
		} else {
			close;
		}
	}

	// ===============================
	// ผู้เล่นกด NPC ระหว่างกิจกรรม
	// ===============================
	if (!$@status_event_active) {
		mes "[กิจกรรม]";
		mes "กิจกรรมยังไม่เริ่ม หรือได้สิ้นสุดไปแล้ว.";
		close;
	}

	if ($@status_event_winner$ != "") {
		mes "[กิจกรรม]";
		mes "ผู้ชนะคือ " + $@status_event_winner$ + ".";
		close;
	}

	// สุ่มโอกาสชนะ
	if (rand(100) < 3) {
		$@status_event_winner$ = strcharinfo(0);
		mes "[กิจกรรม]";
		mes "คุณคือผู้ชนะ!!";
		announce "[กิจกรรมสุ่มสถานะ] ผู้ชนะคือ " + strcharinfo(0) + "!", bc_all;
		// สามารถให้รางวัลได้ที่นี่
		getitem 2001101, 1; // หญ้ายีในตำนาน
		$@status_event_active = 0;
		stopnpctimer;
		end;
	}

	// ถ้าไม่ชนะ โดนสถานะสุ่ม
	switch (rand(0, 12)) {
		case 0: sc_start SC_SLEEP, 5000, 0; break;
		case 1: sc_start SC_STONE, 5000, 0; break;
		case 2: sc_start SC_FREEZE, 5000, 0; break;
		case 3: sc_start SC_COMA, 5000, 0; break;
		case 4: percentheal -100, -100; break;
		case 5: sc_start SC_STONE, 5000, 0; break;
		case 6: sc_start SC_FREEZE, 5000, 0; break;
		case 7: sc_start SC_COMA, 5000, 0; break;
		case 8: sc_start SC_SLEEP, 5000, 0; break;
		case 9: percentheal -100, -100; break;
		case 10: sc_start SC_STUN, 5000, 0; break;
		case 11: sc_start SC_STUN, 5000, 0; break;
		case 12: sc_start SC_SLEEP, 5000, 0; break;
	}
	close;

OnTimer300000: // 5 นาที = 300,000 ms
	stopnpctimer;
	if ($@status_event_winner$ == "") {
		announce "[กิจกรรมสุ่มสถานะ] สิ้นสุดลงโดยไม่มีผู้ชนะ.", bc_all;
	}
	$@status_event_active = 0;
	$@status_event_winner$ = "";
	end;
}