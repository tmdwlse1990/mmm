-	shop	#look	-1,501:-1

icecastle,189,206,5	script	ไก่วิเศษ	800,{
	callfunc "F_MapleCube",1;
	end;
	/*
	// Fill the arrays using the random option group ID 5 (group used for Crimson weapons).
	randomoptgroup(401);

	// Create a +9 Crimson Dagger [2] with the Group 5 applied
	getitem3 28705,1,1,9,0,0,0,0,0,.@opt_id,.@opt_value,.@opt_param;
	
	end;
	*/
}

function	script	F_MapleCube	{
	disable_items;
	.@tier = getarg(0);
	mes "โปรดเลือก Item (เฉพาะที่สวมใส่อยู่้เท่านั้น)";
	.@menu$ = "";
	for(.@i=0; .@i <= 9; .@i++) {
		if(getequipid(.@i))
			.@menu$ += getequipname(.@i) + ":";
	}
	.@part = select(.@menu$) - 1;
	.@equip_id = getequipid(.@part);
	.@refine = getequiprefinerycnt(.@part);
	.@grade = getenchantgrade(.@part);
	setarray .@card[0],getequipcardid(.@part,0),getequipcardid(.@part,1),getequipcardid(.@part,2),getequipcardid(.@part,3);
	for(.@i=0; .@i <= 3; .@i++) {
		.@opid[.@i] = getequiprandomoption(.@part,.@i,ROA_ID);
		.@opval[.@i] = getequiprandomoption(.@part,.@i,ROA_VALUE);
		.@opparam[.@i] = getequiprandomoption(.@part,.@i,ROA_PARAM);
	}
	
	
	.@location = getiteminfo(.@equip_id, ITEMINFO_LOCATIONS);
	if(.@location & EQP_HAND_L && .@location & EQP_HAND_R)
		.@twohand = 1;
	else if (.@location & EQP_HAND_R)
		.@weapon = 1;
	else
		.@armor = 1;
	
	setarray .@cubelist[1],2002015,2002016,2002017,2002018;
	.@cubeid = .@cubelist[.@tier];
	switch(.@tier){
		case 1:
			if(.@twohand) .@optgroup = 403;
			if(.@weapon) .@optgroup = 402;
			if(.@armor) .@optgroup = 401;
		break;
		case 2:
			if(.@twohand) .@optgroup = 406;
			if(.@weapon) .@optgroup = 405;
			if(.@armor) .@optgroup = 404;
		break;
		case 3:
			if(.@twohand) .@optgroup = 409;
			if(.@weapon) .@optgroup = 408;
			if(.@armor) .@optgroup = 407;
		break;
		case 4:
			if(.@twohand) .@optgroup = 409;
			if(.@weapon) .@optgroup = 408;
			if(.@armor) .@optgroup = 407;
			.@selectable = 1;
		break;
		default:
			.@optgroup = 401;
		break;
	}
	mes "ท่านเลือกที่จะเสริม Potential คือ";
	mes "^FF0000<^i["+.@equip_id+"]>   "+getitemname(.@equip_id)+"^000000";
	mes "ท่านแน่ใจใช่หรือไม่";
	if(select(" - แน่ใจ: - ไม่แน่ใจ") == 2 ) end;
	//dispbottom "Tier:"+.@tier+" get Option:"+.@optgroup;
Again:
	delitem .@cubeid,1;
	randomoptgroup(.@optgroup);
	if(.@selectable) {
		clear2;
		mes "ออฟชั่นเก่าคือ:";
		for(.@i=0;.@i <= getarraysize(.@opid); .@i++) {
			if(.@opid[.@i]) {
				.@roa_id = getequiprandomoption(.@part,.@i,ROA_ID);
				.@roa_value = getequiprandomoption(.@part,.@i,ROA_VALUE);
				mes "^0000ff- "+callfunc("F_GetRDMOPT_Name",.@roa_id)+" "+callfunc("F_GetRDMOPT_Value",.@roa_id,.@roa_value)+"^000000";
			}
		}
		mes "^00961e-------------------------------^000000";
		for(.@i=0;.@i <= getarraysize(.@opt_id); .@i++) {
			if(.@opt_id[.@i]) {
				mes "^0000ff- "+callfunc("F_GetRDMOPT_Name",.@opt_id[.@i])+" "+callfunc("F_GetRDMOPT_Value",.@opt_id[.@i],.@opt_value[.@i])+"^000000";
			}
		}
		mes "^00961e-------------------------------^000000";
		mes "สุ่มใหม่ไหม?";
		setdialogsize(400,260);
		switch(select(" - สุ่มใหม่: - เปลี่ยน: - ยกเลิก") ) {
			case 2:
				break;
			case 1:
				goto Again;
				break;
			case 3:
				close;
		}
	}
	delequip .@part;
	getitem4 .@equip_id,1,1,.@refine,0,.@card[0],.@card[1],.@card[2],.@card[3],.@grade,.@opt_id,.@opt_value,.@opt_param;
	equip .@equip_id;
	close;
}
